var pg = require('./pg.js');

var model = function(row) {
    var keys = Object.keys(row);
    for (var k in keys) {
        this[keys[k]] = row[keys[k]];
    }
};

model.getById = function(Model, id, cb) {
    pg.acquire(function(err, client, release) {
        if (err) return cb(err);

        client.query('SELECT * FROM "' + Model.tableName + '" WHERE "id" = $1;', [ id ], function(err, result) {
            release();
            if (err) return cb(err);

            model._populateOne(Model, result.rows[0], cb);
        });
    });
};

model._populateOne = function(Model, row, cb) {
    if (row)
        return cb(null, new Model(row));
    else
        return cb();
};

module.exports = model;